<ng-form name="vaultSecrets" novalidate>
    <div class="container-fluid form-horizontal" ng-controller="dcosServerGroupVaultSecretsController as vaultSecretsController">
      <div class="form-group">
        <h5 class="col-sm-12">
          Set Vault secrets for each task your service launches.
          <a href="https://www.vaultproject.io">
            Learn more about Vault secrets.
          </a>
        </h5>
        <table class="table table-condensed packed">
          <tbody>
            <tr ng-repeat="secret in command.viewModel.secrets">
              <td>
                <div class="form-group">
                  <div class="col-md-3 sm-label-right">
                    Name                  
                  </div>
                  <div class="col-md-7">
                    <input type="text" class="form-control input-sm highlight-pristine" name="varName_{{$index}}" ng-model="secret.name" validate-unique="secret.checkUnique"
                      required/>
                    <div class="error-message" ng-if="form.$error.validateUnique">Duplicate key</div>
                    <div class="error-message" ng-if="vaultSecrets['varName_' + $index].$error.required">Name is required</div>
                  </div>
                </div>
                <div class="form-group">
                  <div class="col-md-3 sm-label-right">
                    Backend
                    <help-field key="dcos.serverGroup.vaultSecrets.backend"></help-field>
                  </div>
                  <div class="col-md-7">
                    <ui-select name="varBackend_{{$index}}" ng-model="secret.backend" search-enabled="true" on-select="vaultSecretsController.getPolicies($index)"
                      class="form-control input-sm highlight-pristine" required/>
                    <div class="error-message" ng-if="vaultSecrets['varBackend_' + $index].$error.required">Backend is required</div>
                    <ui-select-match title="{{$select.selected}}">{{$select.selected}}</ui-select-match>
                    <ui-select-choices repeat="backend in command.viewModel.backendsList | filter: $select.search">
                      <span ng-bind-html="backend | highlight: $select.search"></span>
                    </ui-select-choices>
                  </div>
                </div>
                <div class="form-group">
                  <div class="col-md-3 sm-label-right">
                    Policy
                    <help-field key="dcos.serverGroup.vaultSecrets.policy"></help-field>
                  </div>
                  <div class="col-md-7">
                    <ui-select name="varPolicy_{{$index}}" ng-model="secret.policy" search-enabled="true" on-select="vaultSecretsController.updatePolicy($index)"
                      class="form-control input-sm highlight-pristine" required/>
                    <div class="error-message" ng-if="vaultSecrets['varPolicy_' + $index].$error.required">Policy is required</div>
                    <ui-select-match title="{{$select.selected}}">{{$select.selected}}</ui-select-match>
                    <ui-select-choices repeat="policy in command.viewModel.secrets.policies | filter: $select.search">
                      <span ng-bind-html="policy | highlight: $select.search"></span>
                    </ui-select-choices>
                    </ui-select>
                  </div>
                  </div>
                  <div class="form-group" ng-show="secret.requiresSetRole">
                    <div class="col-md-3 sm-label-right">
                      Postgres SetRole Role
                      <help-field key="dcos.serverGroup.vaultSecrets.setRole"></help-field>
                    </div>
                      <div class="col-md-7">
                        <input type="text" class="form-control input-sm highlight-pristine" name="varSetRole_{{$index}}" ng-model="secret.setRole"
                        ng-required="secret.requiresSetRole"/>
                        <div class="error-message" ng-if="vaultSecret['varSetRole_' + $index].$valid">PostgreSQL Vault secrets must have a SetRole role specified</div>
                      </div>
                  </div>
                </div>
                <div class="col-md-12 sm-label-right">
                  <a class="btn btn-link sm-label" ng-click="vaultSecretsController.removeSecret($index)">
                    <span class="glyphicon glyphicon-trash"></span> Remove Secret
                  </a>
                </div>
              </td>
            </tr>
          </tbody>
          <tfoot>
            <tr>
              <td colspan="1">
                <button class="add-new col-md-12" ng-click="vaultSecretsController.addSecret()">
                  <span class="glyphicon glyphicon-plus-sign"></span> Add Another Secret
                </button>
              </td>
            </tr>
          </tfoot>
        </table>
      </div>
    </div>
  </ng-form>